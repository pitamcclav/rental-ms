(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[188],{1761:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});let r=(0,n(1847).A)("dollar-sign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},2056:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});let r=(0,n(1847).A)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},3748:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>ed});var r=n(5155),a=n(2115),s=n(3998),i=n(6948),o=n(1834),l=n(5142),d=n(6444),c=n(1186),u=n(7270),h=n(1647),m=n(2556),x=n(3468),p=n(9972),j=n(4446),f=n(8946),v=n(7602),y=n(222),g=n(3558),b=n(6218),w="rovingFocusGroup.onEntryFocus",N={bubbles:!1,cancelable:!0},A="RovingFocusGroup",[D,C,T]=(0,p.N)(A),[F,S]=(0,x.A)(A,[T]),[I,R]=F(A),P=a.forwardRef((e,t)=>(0,r.jsx)(D.Provider,{scope:e.__scopeRovingFocusGroup,children:(0,r.jsx)(D.Slot,{scope:e.__scopeRovingFocusGroup,children:(0,r.jsx)(k,{...e,ref:t})})}));P.displayName=A;var k=a.forwardRef((e,t)=>{let{__scopeRovingFocusGroup:n,orientation:s,loop:i=!1,dir:o,currentTabStopId:l,defaultCurrentTabStopId:d,onCurrentTabStopIdChange:c,onEntryFocus:u,preventScrollOnEntryFocus:h=!1,...x}=e,p=a.useRef(null),f=(0,j.s)(t,p),D=(0,b.jH)(o),[T,F]=(0,g.i)({prop:l,defaultProp:null!=d?d:null,onChange:c,caller:A}),[S,R]=a.useState(!1),P=(0,y.c)(u),k=C(n),M=a.useRef(!1),[E,K]=a.useState(0);return a.useEffect(()=>{let e=p.current;if(e)return e.addEventListener(w,P),()=>e.removeEventListener(w,P)},[P]),(0,r.jsx)(I,{scope:n,orientation:s,dir:D,loop:i,currentTabStopId:T,onItemFocus:a.useCallback(e=>F(e),[F]),onItemShiftTab:a.useCallback(()=>R(!0),[]),onFocusableItemAdd:a.useCallback(()=>K(e=>e+1),[]),onFocusableItemRemove:a.useCallback(()=>K(e=>e-1),[]),children:(0,r.jsx)(v.sG.div,{tabIndex:S||0===E?-1:0,"data-orientation":s,...x,ref:f,style:{outline:"none",...e.style},onMouseDown:(0,m.mK)(e.onMouseDown,()=>{M.current=!0}),onFocus:(0,m.mK)(e.onFocus,e=>{let t=!M.current;if(e.target===e.currentTarget&&t&&!S){let t=new CustomEvent(w,N);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){let e=k().filter(e=>e.focusable);B([e.find(e=>e.active),e.find(e=>e.id===T),...e].filter(Boolean).map(e=>e.ref.current),h)}}M.current=!1}),onBlur:(0,m.mK)(e.onBlur,()=>R(!1))})})}),M="RovingFocusGroupItem",E=a.forwardRef((e,t)=>{let{__scopeRovingFocusGroup:n,focusable:s=!0,active:i=!1,tabStopId:o,children:l,...d}=e,c=(0,f.B)(),u=o||c,h=R(M,n),x=h.currentTabStopId===u,p=C(n),{onFocusableItemAdd:j,onFocusableItemRemove:y,currentTabStopId:g}=h;return a.useEffect(()=>{if(s)return j(),()=>y()},[s,j,y]),(0,r.jsx)(D.ItemSlot,{scope:n,id:u,focusable:s,active:i,children:(0,r.jsx)(v.sG.span,{tabIndex:x?0:-1,"data-orientation":h.orientation,...d,ref:t,onMouseDown:(0,m.mK)(e.onMouseDown,e=>{s?h.onItemFocus(u):e.preventDefault()}),onFocus:(0,m.mK)(e.onFocus,()=>h.onItemFocus(u)),onKeyDown:(0,m.mK)(e.onKeyDown,e=>{if("Tab"===e.key&&e.shiftKey)return void h.onItemShiftTab();if(e.target!==e.currentTarget)return;let t=function(e,t,n){var r;let a=(r=e.key,"rtl"!==n?r:"ArrowLeft"===r?"ArrowRight":"ArrowRight"===r?"ArrowLeft":r);if(!("vertical"===t&&["ArrowLeft","ArrowRight"].includes(a))&&!("horizontal"===t&&["ArrowUp","ArrowDown"].includes(a)))return K[a]}(e,h.orientation,h.dir);if(void 0!==t){if(e.metaKey||e.ctrlKey||e.altKey||e.shiftKey)return;e.preventDefault();let n=p().filter(e=>e.focusable).map(e=>e.ref.current);if("last"===t)n.reverse();else if("prev"===t||"next"===t){"prev"===t&&n.reverse();let r=n.indexOf(e.currentTarget);n=h.loop?function(e,t){return e.map((n,r)=>e[(t+r)%e.length])}(n,r+1):n.slice(r+1)}setTimeout(()=>B(n))}}),children:"function"==typeof l?l({isCurrentTabStop:x,hasTabStop:null!=g}):l})})});E.displayName=M;var K={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function B(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=document.activeElement;for(let r of e)if(r===n||(r.focus({preventScroll:t}),document.activeElement!==n))return}var L=n(6842),O="Tabs",[_,G]=(0,x.A)(O,[S]),H=S(),[q,U]=_(O),J=a.forwardRef((e,t)=>{let{__scopeTabs:n,value:a,onValueChange:s,defaultValue:i,orientation:o="horizontal",dir:l,activationMode:d="automatic",...c}=e,u=(0,b.jH)(l),[h,m]=(0,g.i)({prop:a,onChange:s,defaultProp:null!=i?i:"",caller:O});return(0,r.jsx)(q,{scope:n,baseId:(0,f.B)(),value:h,onValueChange:m,orientation:o,dir:u,activationMode:d,children:(0,r.jsx)(v.sG.div,{dir:u,"data-orientation":o,...c,ref:t})})});J.displayName=O;var z="TabsList",V=a.forwardRef((e,t)=>{let{__scopeTabs:n,loop:a=!0,...s}=e,i=U(z,n),o=H(n);return(0,r.jsx)(P,{asChild:!0,...o,orientation:i.orientation,dir:i.dir,loop:a,children:(0,r.jsx)(v.sG.div,{role:"tablist","aria-orientation":i.orientation,...s,ref:t})})});V.displayName=z;var Z="TabsTrigger",X=a.forwardRef((e,t)=>{let{__scopeTabs:n,value:a,disabled:s=!1,...i}=e,o=U(Z,n),l=H(n),d=Q(o.baseId,a),c=Y(o.baseId,a),u=a===o.value;return(0,r.jsx)(E,{asChild:!0,...l,focusable:!s,active:u,children:(0,r.jsx)(v.sG.button,{type:"button",role:"tab","aria-selected":u,"aria-controls":c,"data-state":u?"active":"inactive","data-disabled":s?"":void 0,disabled:s,id:d,...i,ref:t,onMouseDown:(0,m.mK)(e.onMouseDown,e=>{s||0!==e.button||!1!==e.ctrlKey?e.preventDefault():o.onValueChange(a)}),onKeyDown:(0,m.mK)(e.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&o.onValueChange(a)}),onFocus:(0,m.mK)(e.onFocus,()=>{let e="manual"!==o.activationMode;u||s||!e||o.onValueChange(a)})})})});X.displayName=Z;var W="TabsContent",$=a.forwardRef((e,t)=>{let{__scopeTabs:n,value:s,forceMount:i,children:o,...l}=e,d=U(W,n),c=Q(d.baseId,s),u=Y(d.baseId,s),h=s===d.value,m=a.useRef(h);return a.useEffect(()=>{let e=requestAnimationFrame(()=>m.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,r.jsx)(L.C,{present:i||h,children:n=>{let{present:a}=n;return(0,r.jsx)(v.sG.div,{"data-state":h?"active":"inactive","data-orientation":d.orientation,role:"tabpanel","aria-labelledby":c,hidden:!a,id:u,tabIndex:0,...l,ref:t,style:{...e.style,animationDuration:m.current?"0s":void 0},children:a&&o})}})});function Q(e,t){return"".concat(e,"-trigger-").concat(t)}function Y(e,t){return"".concat(e,"-content-").concat(t)}$.displayName=W;var ee=n(4269);function et(e){let{className:t,...n}=e;return(0,r.jsx)(J,{"data-slot":"tabs",className:(0,ee.cn)("flex flex-col gap-2",t),...n})}function en(e){let{className:t,...n}=e;return(0,r.jsx)(V,{"data-slot":"tabs-list",className:(0,ee.cn)("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",t),...n})}function er(e){let{className:t,...n}=e;return(0,r.jsx)(X,{"data-slot":"tabs-trigger",className:(0,ee.cn)("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...n})}function ea(e){let{className:t,...n}=e;return(0,r.jsx)($,{"data-slot":"tabs-content",className:(0,ee.cn)("flex-1 outline-none",t),...n})}var es=n(1761),ei=n(6191),eo=n(2056),el=n(8720);function ed(){let[e,t]=(0,a.useState)([]),[n,m]=(0,a.useState)([]),[x,p]=(0,a.useState)({overdue:[],dueThisMonth:[]}),[j,f]=(0,a.useState)(!0),[v,y]=(0,a.useState)(!1),[g,b]=(0,a.useState)({tenantId:"",unitId:"",amount:"",paymentDate:new Date().toISOString().split("T")[0],monthsCovered:"1",paymentMethod:"",reference:""});(0,a.useEffect)(()=>{w(),N(),A()},[]);let w=async()=>{try{let e=await fetch("/api/payments"),n=await e.json();t(n)}catch(e){el.oR.error("Failed to fetch payments")}finally{f(!1)}},N=async()=>{try{let e=await fetch("/api/tenants"),t=await e.json();m(t.filter(e=>e.unit))}catch(e){el.oR.error("Failed to fetch tenants")}},A=async()=>{try{let e=await fetch("/api/payments/upcoming"),t=await e.json();p(t)}catch(e){console.error("Failed to fetch upcoming payments")}},D=async e=>{e.preventDefault();try{let e=await fetch("/api/payments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...g,amount:parseFloat(g.amount),monthsCovered:parseInt(g.monthsCovered)})}),t=await e.json();if(!e.ok)throw Error("Failed to record payment");el.oR.success(t.emailError?"Payment recorded (".concat(t.emailError,")"):"Payment recorded and receipt sent"),y(!1),C(),w(),A()}catch(e){el.oR.error("Failed to record payment")}},C=()=>{b({tenantId:"",unitId:"",amount:"",paymentDate:new Date().toISOString().split("T")[0],monthsCovered:"1",paymentMethod:"",reference:""})};return j?(0,r.jsx)("div",{className:"flex items-center justify-center h-64",children:"Loading..."}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[(0,r.jsx)(es.A,{className:"h-8 w-8"}),"Payments"]}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Track rent payments and upcoming due dates"})]}),(0,r.jsxs)(o.lG,{open:v,onOpenChange:e=>{y(e),e||C()},children:[(0,r.jsx)(o.zM,{asChild:!0,children:(0,r.jsxs)(s.$,{children:[(0,r.jsx)(ei.A,{className:"h-4 w-4 mr-2"}),"Record Payment"]})}),(0,r.jsx)(o.Cf,{children:(0,r.jsxs)("form",{onSubmit:D,children:[(0,r.jsxs)(o.c7,{children:[(0,r.jsx)(o.L3,{children:"Record Payment"}),(0,r.jsx)(o.rr,{children:"Record a new rent payment and send receipt via email"})]}),(0,r.jsxs)("div",{className:"space-y-4 py-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"tenant",children:"Tenant"}),(0,r.jsxs)(c.l6,{value:g.tenantId,onValueChange:e=>{let t=n.find(t=>t.id===e);t&&b({...g,tenantId:e,unitId:t.unit.id,amount:t.unit.rentAmount.toString()})},required:!0,children:[(0,r.jsx)(c.bq,{children:(0,r.jsx)(c.yv,{placeholder:"Select tenant"})}),(0,r.jsx)(c.gC,{children:n.map(e=>(0,r.jsxs)(c.eb,{value:e.id,children:[e.name," - ",e.unit.name]},e.id))})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"amount",children:"Amount"}),(0,r.jsx)(l.p,{id:"amount",type:"number",step:"0.01",value:g.amount,onChange:e=>b({...g,amount:e.target.value}),placeholder:"e.g., 1200.00",required:!0})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"paymentDate",children:"Payment Date"}),(0,r.jsx)(l.p,{id:"paymentDate",type:"date",value:g.paymentDate,onChange:e=>b({...g,paymentDate:e.target.value}),required:!0})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"monthsCovered",children:"Months Covered"}),(0,r.jsx)(l.p,{id:"monthsCovered",type:"number",min:"1",value:g.monthsCovered,onChange:e=>b({...g,monthsCovered:e.target.value}),required:!0})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"paymentMethod",children:"Payment Method (Optional)"}),(0,r.jsx)(l.p,{id:"paymentMethod",value:g.paymentMethod,onChange:e=>b({...g,paymentMethod:e.target.value}),placeholder:"e.g., Cash, Bank Transfer"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"reference",children:"Reference Number (Optional)"}),(0,r.jsx)(l.p,{id:"reference",value:g.reference,onChange:e=>b({...g,reference:e.target.value}),placeholder:"e.g., TXN123456"})]})]}),(0,r.jsx)(o.Es,{children:(0,r.jsx)(s.$,{type:"submit",children:"Record Payment"})})]})})]})]}),(0,r.jsxs)(et,{defaultValue:"all",className:"space-y-4",children:[(0,r.jsxs)(en,{children:[(0,r.jsx)(er,{value:"all",children:"All Payments"}),(0,r.jsxs)(er,{value:"upcoming",children:["Upcoming",x.dueThisMonth.length>0&&(0,r.jsx)(h.E,{variant:"secondary",className:"ml-2",children:x.dueThisMonth.length})]}),(0,r.jsxs)(er,{value:"overdue",children:["Overdue",x.overdue.length>0&&(0,r.jsx)(h.E,{variant:"destructive",className:"ml-2",children:x.overdue.length})]})]}),(0,r.jsx)(ea,{value:"all",children:(0,r.jsxs)(i.Zp,{children:[(0,r.jsxs)(i.aR,{children:[(0,r.jsx)(i.ZB,{children:"Payment History"}),(0,r.jsx)(i.BT,{children:"All recorded payments"})]}),(0,r.jsx)(i.Wu,{children:0===e.length?(0,r.jsx)("p",{className:"text-center text-muted-foreground py-8",children:"No payments recorded yet."}):(0,r.jsxs)(u.XI,{children:[(0,r.jsx)(u.A0,{children:(0,r.jsxs)(u.Hj,{children:[(0,r.jsx)(u.nd,{children:"Tenant"}),(0,r.jsx)(u.nd,{children:"Unit"}),(0,r.jsx)(u.nd,{children:"Amount"}),(0,r.jsx)(u.nd,{children:"Payment Date"}),(0,r.jsx)(u.nd,{children:"Period"}),(0,r.jsx)(u.nd,{children:"Months"})]})}),(0,r.jsx)(u.BF,{children:e.map(e=>(0,r.jsxs)(u.Hj,{children:[(0,r.jsx)(u.nA,{className:"font-medium",children:e.tenant.name}),(0,r.jsx)(u.nA,{children:e.unit.name}),(0,r.jsx)(u.nA,{className:"font-bold",children:(0,ee.v)(e.amount.toString())}),(0,r.jsx)(u.nA,{children:new Date(e.paymentDate).toLocaleDateString()}),(0,r.jsxs)(u.nA,{className:"text-xs text-muted-foreground",children:[new Date(e.periodStart).toLocaleDateString()," - ",new Date(e.periodEnd).toLocaleDateString()]}),(0,r.jsx)(u.nA,{className:"text-center",children:e.monthsCovered})]},e.id))})]})})]})}),(0,r.jsx)(ea,{value:"upcoming",children:(0,r.jsxs)(i.Zp,{children:[(0,r.jsxs)(i.aR,{children:[(0,r.jsx)(i.ZB,{children:"Upcoming Payments"}),(0,r.jsx)(i.BT,{children:"Payments due this month"})]}),(0,r.jsx)(i.Wu,{children:0===x.dueThisMonth.length?(0,r.jsx)("p",{className:"text-center text-muted-foreground py-8",children:"No upcoming payments this month."}):(0,r.jsxs)(u.XI,{children:[(0,r.jsx)(u.A0,{children:(0,r.jsxs)(u.Hj,{children:[(0,r.jsx)(u.nd,{children:"Tenant"}),(0,r.jsx)(u.nd,{children:"Unit"}),(0,r.jsx)(u.nd,{children:"Property"}),(0,r.jsx)(u.nd,{children:"Amount"}),(0,r.jsx)(u.nd,{children:"Due Date"})]})}),(0,r.jsx)(u.BF,{children:x.dueThisMonth.map(e=>(0,r.jsxs)(u.Hj,{children:[(0,r.jsx)(u.nA,{className:"font-medium",children:e.tenantName}),(0,r.jsx)(u.nA,{children:e.unitName}),(0,r.jsx)(u.nA,{className:"text-muted-foreground",children:e.propertyName}),(0,r.jsx)(u.nA,{className:"font-bold",children:(0,ee.v)(e.rentAmount.toString())}),(0,r.jsx)(u.nA,{children:new Date(e.nextDueDate).toLocaleDateString()})]},e.tenantId))})]})})]})}),(0,r.jsx)(ea,{value:"overdue",children:(0,r.jsxs)(i.Zp,{children:[(0,r.jsxs)(i.aR,{children:[(0,r.jsxs)(i.ZB,{className:"flex items-center gap-2",children:[(0,r.jsx)(eo.A,{className:"h-5 w-5 text-destructive"}),"Overdue Payments"]}),(0,r.jsx)(i.BT,{children:"Payments that are past due"})]}),(0,r.jsx)(i.Wu,{children:0===x.overdue.length?(0,r.jsx)("p",{className:"text-center text-muted-foreground py-8",children:"No overdue payments."}):(0,r.jsxs)(u.XI,{children:[(0,r.jsx)(u.A0,{children:(0,r.jsxs)(u.Hj,{children:[(0,r.jsx)(u.nd,{children:"Tenant"}),(0,r.jsx)(u.nd,{children:"Unit"}),(0,r.jsx)(u.nd,{children:"Property"}),(0,r.jsx)(u.nd,{children:"Amount"}),(0,r.jsx)(u.nd,{children:"Due Date"}),(0,r.jsx)(u.nd,{children:"Status"})]})}),(0,r.jsx)(u.BF,{children:x.overdue.map(e=>(0,r.jsxs)(u.Hj,{children:[(0,r.jsx)(u.nA,{className:"font-medium",children:e.tenantName}),(0,r.jsx)(u.nA,{children:e.unitName}),(0,r.jsx)(u.nA,{className:"text-muted-foreground",children:e.propertyName}),(0,r.jsx)(u.nA,{className:"font-bold",children:(0,ee.v)(e.rentAmount.toString())}),(0,r.jsx)(u.nA,{children:new Date(e.nextDueDate).toLocaleDateString()}),(0,r.jsx)(u.nA,{children:(0,r.jsxs)(h.E,{variant:"destructive",children:[e.daysOverdue," days overdue"]})})]},e.tenantId))})]})})]})})]})]})}},9332:(e,t,n)=>{Promise.resolve().then(n.bind(n,3748))}},e=>{e.O(0,[678,817,4,702,441,255,358],()=>e(e.s=9332)),_N_E=e.O()}]);